<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.7.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="key wordG1, RSets, CSetsfor Hotspot JVM  ç®€å•è¯´è¯´G1æ˜¯ä»€ä¹ˆï¼ŸG1ç›®æ ‡ å‡å°‘fullgc  ä¸ºä»€ä¹ˆå«åšgarbage first G1çš„åŸºç¡€æ˜¯regionï¼Œåœ¨æ‰§è¡Œgcæ—¶ï¼ŒG1é¦–å…ˆæ‰¾å‡ºé‚£äº›regionå‡ ä¹æ˜¯ç©ºçš„ï¼Œä¼˜å…ˆå›æ”¶ï¼›å› æ­¤ç§°ä¸º Garbage First  æœ‰ä»€ä¹ˆä¸åŒ(å¯¹æ¯”Serial,Parallel,CMS)   Serial,Parallel,CMS">
<meta name="keywords" content="jvm,gc">
<meta property="og:type" content="article">
<meta property="og:title" content="G1 é‚£äº›äº‹å„¿">
<meta property="og:url" content="http://wiki.anocelot.cn/2018/03/17/jvm-g1/index.html">
<meta property="og:site_name" content="ç›—æ¢¦ de è™çŒ«">
<meta property="og:description" content="key wordG1, RSets, CSetsfor Hotspot JVM  ç®€å•è¯´è¯´G1æ˜¯ä»€ä¹ˆï¼ŸG1ç›®æ ‡ å‡å°‘fullgc  ä¸ºä»€ä¹ˆå«åšgarbage first G1çš„åŸºç¡€æ˜¯regionï¼Œåœ¨æ‰§è¡Œgcæ—¶ï¼ŒG1é¦–å…ˆæ‰¾å‡ºé‚£äº›regionå‡ ä¹æ˜¯ç©ºçš„ï¼Œä¼˜å…ˆå›æ”¶ï¼›å› æ­¤ç§°ä¸º Garbage First  æœ‰ä»€ä¹ˆä¸åŒ(å¯¹æ¯”Serial,Parallel,CMS)   Serial,Parallel,CMS">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://anocelot-wiki.oss-cn-hangzhou.aliyuncs.com/wiki/jvm-g1/OldHeapStructure.png">
<meta property="og:image" content="http://anocelot-wiki.oss-cn-hangzhou.aliyuncs.com/wiki/jvm-g1/G1HeapStructure.png">
<meta property="og:updated_time" content="2019-07-18T08:17:40.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="G1 é‚£äº›äº‹å„¿">
<meta name="twitter:description" content="key wordG1, RSets, CSetsfor Hotspot JVM  ç®€å•è¯´è¯´G1æ˜¯ä»€ä¹ˆï¼ŸG1ç›®æ ‡ å‡å°‘fullgc  ä¸ºä»€ä¹ˆå«åšgarbage first G1çš„åŸºç¡€æ˜¯regionï¼Œåœ¨æ‰§è¡Œgcæ—¶ï¼ŒG1é¦–å…ˆæ‰¾å‡ºé‚£äº›regionå‡ ä¹æ˜¯ç©ºçš„ï¼Œä¼˜å…ˆå›æ”¶ï¼›å› æ­¤ç§°ä¸º Garbage First  æœ‰ä»€ä¹ˆä¸åŒ(å¯¹æ¯”Serial,Parallel,CMS)   Serial,Parallel,CMS">
<meta name="twitter:image" content="http://anocelot-wiki.oss-cn-hangzhou.aliyuncs.com/wiki/jvm-g1/OldHeapStructure.png">






  <link rel="canonical" href="http://wiki.anocelot.cn/2018/03/17/jvm-g1/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>G1 é‚£äº›äº‹å„¿ | ç›—æ¢¦ de è™çŒ«</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ç›—æ¢¦ de è™çŒ«</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-ä¸»é¡µ">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>ä¸»é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-åˆ†ç±»">

    
    
    
      
    

    

    <a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>åˆ†ç±»</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-æ ‡ç­¾">

    
    
    
      
    

    

    <a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tag"></i> <br>æ ‡ç­¾</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-å½’æ¡£">

    
    
    
      
    

    

    <a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wiki.anocelot.cn/2018/03/17/jvm-g1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç›—æ¢¦çš„è™çŒ«">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/3364273?v=3&u=ce716f2b74223dc0e4d236c952aa946ce33b4c4b&s=100">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç›—æ¢¦ de è™çŒ«">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">G1 é‚£äº›äº‹å„¿

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-17 15:16:51" itemprop="dateCreated datePublished" datetime="2018-03-17T15:16:51+08:00">2018-03-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-18 16:17:40" itemprop="dateModified" datetime="2019-07-18T16:17:40+08:00">2019-07-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="key-word"><a href="#key-word" class="headerlink" title="key word"></a>key word</h1><p>G1, RSets, CSets<br><strong>for Hotspot JVM</strong></p>
<hr>
<h1 id="ç®€å•è¯´è¯´G1æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ç®€å•è¯´è¯´G1æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç®€å•è¯´è¯´G1æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ç®€å•è¯´è¯´G1æ˜¯ä»€ä¹ˆï¼Ÿ</h1><h2 id="G1ç›®æ ‡"><a href="#G1ç›®æ ‡" class="headerlink" title="G1ç›®æ ‡"></a>G1ç›®æ ‡</h2><ul>
<li>å‡å°‘fullgc</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆå«åšgarbage-first"><a href="#ä¸ºä»€ä¹ˆå«åšgarbage-first" class="headerlink" title="ä¸ºä»€ä¹ˆå«åšgarbage first"></a>ä¸ºä»€ä¹ˆå«åšgarbage first</h2><blockquote>
<p>G1çš„åŸºç¡€æ˜¯regionï¼Œåœ¨æ‰§è¡Œgcæ—¶ï¼ŒG1é¦–å…ˆæ‰¾å‡ºé‚£äº›regionå‡ ä¹æ˜¯ç©ºçš„ï¼Œä¼˜å…ˆå›æ”¶ï¼›å› æ­¤ç§°ä¸º Garbage First</p>
</blockquote>
<h2 id="æœ‰ä»€ä¹ˆä¸åŒ-å¯¹æ¯”Serial-Parallel-CMS"><a href="#æœ‰ä»€ä¹ˆä¸åŒ-å¯¹æ¯”Serial-Parallel-CMS" class="headerlink" title="æœ‰ä»€ä¹ˆä¸åŒ(å¯¹æ¯”Serial,Parallel,CMS)"></a>æœ‰ä»€ä¹ˆä¸åŒ(å¯¹æ¯”Serial,Parallel,CMS)</h2><table>
<thead>
<tr>
<th>Serial,Parallel,CMS</th>
<th>G1</th>
</tr>
</thead>
<tbody>
<tr>
<td>å †ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œåˆ†ä¸ºæ–°ç”Ÿä»£ï¼Œsurvivorå’Œè€å¹´ä»£</td>
<td>regionæ¦‚å¿µï¼Œæ¯ä¸ªregionæ˜¯2çš„å¹‚æ¬¡æ–¹ï¼ˆ2-32MBï¼‰ï¼Œå¹³å‡2000ä¸ªregion</td>
</tr>
<tr>
<td>å„ä»£æ˜¯è¿ç»­çš„</td>
<td>å¯¹è±¡å†™å…¥regionï¼Œregionå¯èƒ½å±äºæ–°ç”Ÿä»£ï¼Œä¹Ÿå¯èƒ½å±äºè€å¹´ä»£</td>
</tr>
<tr>
<td>å„ä»£å¤§å°å›ºå®š</td>
<td>åŠ¨æ€å†³å®šå“ªäº›regionå±äºæ–°ç”Ÿä»£ã€å“ªäº›å±äºè€å¹´ä»£</td>
</tr>
<tr>
<td>æ¯æ¬¡å¤„ç†ä¸€ä¸ªåˆ†ä»£</td>
<td>æ¯æ¬¡å¤„ç†è‹¥å¹²ä¸ªregionï¼Œä¸”ä¸å½±å“å…¶ä½™region</td>
</tr>
</tbody>
</table>
<h2 id="ç›¸å…³çš„command"><a href="#ç›¸å…³çš„command" class="headerlink" title="ç›¸å…³çš„command"></a>ç›¸å…³çš„command</h2><p>This is the complete list of G1 GC switches. Remember to use the best practices outlined above.</p>
<table>
<thead>
<tr>
<th>Option and Default Value</th>
<th>Description                                                    </th>
</tr>
</thead>
<tbody>
<tr>
<td>-XX:+UseG1GC</td>
<td>Use the Garbage First (G1) Collector</td>
</tr>
<tr>
<td>-XX:MaxGCPauseMillis=n</td>
<td>Sets a target for the maximum GC pause time. This is a soft goal, and the JVM will make its best effort to achieve it.</td>
</tr>
<tr>
<td>-XX:InitiatingHeapOccupancyPercent=n</td>
<td>Percentage of the (entire) heap occupancy to start a concurrent GC cycle. It is used by GCs that trigger a concurrent GC cycle based on the occupancy of the entire heap, not just one of the generations (e.g., G1). A value of 0 denotes â€˜do constant GC cyclesâ€™. The default value is 45.</td>
</tr>
<tr>
<td>-XX:NewRatio=n</td>
<td>Ratio of new/old generation sizes. The default value is 2.</td>
</tr>
<tr>
<td>-XX:SurvivorRatio=n</td>
<td>Ratio of eden/survivor space size. The default value is 8.</td>
</tr>
<tr>
<td>-XX:MaxTenuringThreshold=n</td>
<td>Maximum value for tenuring threshold. The default value is 15. </td>
</tr>
<tr>
<td>-XX:ParallelGCThreads=n</td>
<td>Sets the number of threads used during parallel phases of the garbage collectors. The default value varies with the platform on which the JVM is running.</td>
</tr>
<tr>
<td>-XX:ConcGCThreads=n</td>
<td>Number of threads concurrent garbage collectors will use. The default value varies with the platform on which the JVM is running.</td>
</tr>
<tr>
<td>-XX:G1ReservePercent=n</td>
<td>Sets the amount of heap that is reserved as a false ceiling to reduce the possibility of promotion failure. The default value is 10.</td>
</tr>
<tr>
<td>-XX:G1HeapRegionSize=n</td>
<td>With G1 the Java heap is subdivided into uniformly sized regions. This sets the size of the individual sub-divisions. The default value of this parameter is determined ergonomically based upon heap size. The minimum value is 1Mb and the maximum value is 32Mb.</td>
</tr>
</tbody>
</table>
<h2 id="æœ€ä½³å®è·µ-Best-practices"><a href="#æœ€ä½³å®è·µ-Best-practices" class="headerlink" title="æœ€ä½³å®è·µ Best practices"></a>æœ€ä½³å®è·µ Best practices</h2><ul>
<li>ä¸è¦è®¾ç½®æ–°ç”Ÿä»£å¤§å°(Do not set young generation size by -Xmn)<ul>
<li>G1 will no longer respect the pause time target for collections. So in essence, setting the young generation size disables the pause time goal.</li>
<li>G1 is no longer able to expand and contract the young generation space as needed. Since the size is fixed, no changes can be made to the size.</li>
</ul>
</li>
<li>GCæš‚åœæ—¶é—´ä¸æ˜¯100%èƒ½ä¿è¯çš„(Response Time Metrics)<br>Instead of using average response time (ART) as a metric to set the XX:MaxGCPauseMillis=<n>, consider setting value that will meet the goal 90% of the time or more. This means 90% of users making a request will not experience a response time higher than the goal. Remember, the pause time is a goal and is not guaranteed to always be met.</n></li>
<li>æ™‹å‡å¤±è´¥ä»¥åŠå¦‚ä½•é¿å…(Evacuation Failure)<br>å¦‚æœGCçš„æ™‹å‡è¿‡ç¨‹ä¸­é‡åˆ°å †åŒºåŸŸæº¢å‡ºï¼ˆä½¿ç”¨-XX:+PrintGCDetailsçœ‹åˆ°to-space overflowï¼‰ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‡ ç§æ–¹å¼é¿å…ï¼š<ul>
<li>å¢åŠ -XX:G1ReservePercent=nï¼Œç¼ºçœå€¼æ˜¯10ã€‚è¿™å¯ä»¥å¢åŠ å¯ç”¨çš„to-spaceå†…å­˜</li>
<li>ä½¿ç”¨-XX:ConcGCThreads=nå¢åŠ æ ‡è®°çº¿ç¨‹æ•°ç›®</li>
</ul>
</li>
</ul>
<h1 id="CMS-vs-G1"><a href="#CMS-vs-G1" class="headerlink" title="CMS vs G1"></a>CMS vs G1</h1><p>CMSï¼šold generation æ˜¯ä¸€ä¸ªè¿ç»­ç©ºé—´ï¼Œåªæœ‰å‘ç”Ÿfull gcæ—¶æ‰ä¼šè¿›è¡Œå‹ç¼©</p>
<h2 id="çœ‹å›¾è¯´è¯"><a href="#çœ‹å›¾è¯´è¯" class="headerlink" title="çœ‹å›¾è¯´è¯"></a>çœ‹å›¾è¯´è¯</h2><h3 id="CMS-å †ç»“æ„ï¼ˆHeap-Structureï¼‰"><a href="#CMS-å †ç»“æ„ï¼ˆHeap-Structureï¼‰" class="headerlink" title="CMS å †ç»“æ„ï¼ˆHeap Structureï¼‰"></a>CMS å †ç»“æ„ï¼ˆHeap Structureï¼‰</h3><p><img src="http://anocelot-wiki.oss-cn-hangzhou.aliyuncs.com/wiki/jvm-g1/OldHeapStructure.png" alt></p>
<h3 id="G1-å †ç»“æ„ï¼ˆHeap-Structureï¼‰"><a href="#G1-å †ç»“æ„ï¼ˆHeap-Structureï¼‰" class="headerlink" title="G1 å †ç»“æ„ï¼ˆHeap Structureï¼‰"></a>G1 å †ç»“æ„ï¼ˆHeap Structureï¼‰</h3><p><img src="http://anocelot-wiki.oss-cn-hangzhou.aliyuncs.com/wiki/jvm-g1/G1HeapStructure.png" alt></p>
<h2 id="CMS-step"><a href="#CMS-step" class="headerlink" title="CMS step"></a>CMS step</h2><p><strong>ç¼ºç‚¹</strong>ï¼šä¸æ”¯æŒå‹ç¼©ï¼ˆcompactï¼‰</p>
<p><strong>ä¸¤æ¬¡stw</strong>ï¼šInitial Mark, Remark</p>
<p>The CMS collector performs the following phases on the old generation of the heap:</p>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>(1) Initial Mark  <font color="#0099ff"><strong>(Stop the World Event)</strong></font></td>
<td>Objects in old generation are â€œmarkedâ€ as reachable including those objects which may be reachable from young generation. Pause times are typically short in duration relative to minor collection pause times.</td>
</tr>
<tr>
<td>(2) Concurrent Marking</td>
<td>Traverse the tenured generation object graph for reachable objects concurrently while Java application threads are executing. Starts scanning from marked objects and transitively marks all objects reachable from the roots. The mutators are executing during the concurrent phases 2, 3, and 5 and any objects allocated in the CMS generation during these phases (including promoted objects) are immediately marked as live.</td>
</tr>
<tr>
<td>(3) Remark  <font color="#0099ff"><strong>(Stop the World Event)</strong></font></td>
<td>Finds objects that were missed by the concurrent mark phase due to updates by Java application threads to objects after the concurrent collector had finished tracing that object.</td>
</tr>
<tr>
<td>(4) Concurrent Sweep</td>
<td>Collects the objects identified as unreachable during marking phases. The collection of a dead object adds the space for the object to a free list for later allocation. Coalescing of dead objects may occur at this point. Note that live objects are not moved.</td>
</tr>
<tr>
<td>(5) Resetting</td>
<td>Prepare for next concurrent collection by clearing data structures.</td>
</tr>
</tbody>
</table>
<h2 id="G1-step"><a href="#G1-step" class="headerlink" title="G1 step"></a>G1 step</h2><p>The G1 collector performs the following phases on the old generation of the heap. Note that some phases are part of a young generation collection.</p>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Description  </th>
</tr>
</thead>
<tbody>
<tr>
<td>(1) Initial Mark  <font color="#0099ff"><strong>(Stop the World Event)</strong></font></td>
<td>This is a stop the world event. With G1, it is piggybacked on a normal young GC. Mark survivor regions (root regions) which may have references to objects in old generation.</td>
</tr>
<tr>
<td>(2) Root Region Scanning</td>
<td>Scan survivor regions for references into the old generation. This happens while the application continues to run. The phase must be completed before a young GC can occur. </td>
</tr>
<tr>
<td>(3) Concurrent Marking</td>
<td>Find live objects over the entire heap. This happens while the application is running. This phase can be interrupted by young generation garbage collections.</td>
</tr>
<tr>
<td>(4) Remark  <font color="#0099ff"><strong>(Stop the World Event)</strong></font></td>
<td>Completes the marking of live object in the heap. Uses an algorithm called snapshot-at-the-beginning (SATB) which is much faster than what was used in the CMS collector. </td>
</tr>
<tr>
<td>(5) Cleanup  <font color="#0099ff"><strong>(Stop the World Event and Concurrent)</strong></font></td>
<td>1 Performs accounting on live objects and completely free regions. (Stop the world) 2 Scrubs the Remembered Sets. (Stop the world) 3 Reset the empty regions and return them to the free list. (Concurrent)</td>
</tr>
<tr>
<td>(*) Copying  <font color="#0099ff"><strong>(Stop the World Event)</strong></font></td>
<td>These are the stop the world pauses to evacuate or copy live objects to new unused regions. This can be done with young generation regions which are logged as <code>[GC pause (young)]</code>. Or both young and old generation regions which are logged as <code>[GC Pause (mixed)]</code></td>
</tr>
</tbody>
</table>
<hr>
<p>ref <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3RlY2huZXR3b3JrL3R1dG9yaWFscy90dXRvcmlhbHMtMTg3NjU3NC5odG1s" title="http://www.oracle.com/technetwork/tutorials/tutorials-1876574.html">Oracle Getting Started with the G1 Garbage Collector<i class="fa fa-external-link"></i></span></p>
<h1 id="The-G1-Garbage-Collector"><a href="#The-G1-Garbage-Collector" class="headerlink" title="The G1 Garbage Collector"></a>The G1 Garbage Collector</h1><blockquote>
<ol>
<li>ç”¨äºæ›¿ä»£CMS</li>
<li>å‹ç¼©ç©ºä½™ç©ºé—´æ—¶å¿…æ»¡å»¶é•¿ä¸­æ–­æ—¶é—´</li>
<li>æ— éœ€ç‰ºç‰²ååé‡</li>
</ol>
</blockquote>
<p>The Garbage-First (G1) collector is a server-style garbage collector, targeted for multi-processor machines with large memories. It meets garbage collection (GC) pause time goals with a high probability, while achieving high throughput. <em>The G1 garbage collector is fully supported in Oracle JDK 7 update 4 and later releases</em>. The G1 collector is designed for applications that:</p>
<ul>
<li>Can operate concurrently with applications threads like the CMS collector.</li>
<li>Compact free space without lengthy GC induced pause times.</li>
<li>Need more predictable GC pause durations.</li>
<li>Do not want to sacrifice a lot of throughput performance.</li>
<li>Do not require a much larger Java heap.</li>
</ul>
<p>G1 is planned as the long term replacement for the Concurrent Mark-Sweep Collector (CMS). Comparing G1 with CMS, there are differences that make G1 a better solution. One difference is that G1 is a compacting collector. G1 compacts sufficiently to completely avoid the use of fine-grained free lists for allocation, and instead relies on regions. This considerably simplifies parts of the collector, and mostly eliminates potential fragmentation issues. Also, G1 offers more predictable garbage collection pauses than the CMS collector, and allows users to specify desired pause targets.</p>
<h1 id="G1-vs-Serial-Parallel-CMS"><a href="#G1-vs-Serial-Parallel-CMS" class="headerlink" title="G1 vs Serial,Parallel,CMS"></a>G1 vs Serial,Parallel,CMS</h1><table>
<thead>
<tr>
<th>Serial,Parallel,CMS</th>
<th>G1</th>
</tr>
</thead>
<tbody>
<tr>
<td>all structure the heap into three sections: young generation, old generation, and permanent generation of a fixed memory size</td>
<td>partitioned into a set of equal-sized heap regions, each a contiguous range of virtual memory. Certain region sets are assigned the same roles (eden, survivor, old) as in the older collectors, but there is not a fixed size for them</td>
</tr>
<tr>
<td>å›ºå®šå¤§å°çš„ä¸‰ä¸ªåˆ†åŒº</td>
<td>åˆ†ä¸ºä¸€ç»„ç›¸åŒå¤§å°çš„regionï¼Œregionç”¨äºç»„æˆåˆ†ä»£edenã€survisorã€oldï¼Œæ¯ä¸ªåˆ†ä»£æ²¡æœ‰å›ºå®šçš„å¤§å°</td>
</tr>
</tbody>
</table>
<blockquote>
<ul>
<li>ç”¨æˆ·æŒ‡å®šä¸­æ–­æ—¶é—´(pause time)</li>
<li>G1åœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œæ ‡è®°å¹¶ä¼˜å…ˆå›æ”¶å­˜æ´»æ•°æ®ï¼ˆliveness objectï¼‰è¾ƒå°‘çš„region</li>
<li>G1ä¼šå°†å‡ ä¸ªregionä¸­å¹¸å­˜çš„æ•°æ®åˆå¹¶æ‹·è´åˆ°ä¸€ä¸ªregionï¼Œè¾¾åˆ°é‡Šæ”¾regionçš„ç›®çš„</li>
<li>G1 is not a real-time collectorï¼ˆå¤§æ¦‚å§ğŸ™‚ åœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼Œèƒ½æ”¶é›†å¤šå°‘æ˜¯å¤šå°‘ï¼‰</li>
</ul>
</blockquote>
<p>GCå¯¹æ¯”</p>
<blockquote>
<ul>
<li>CMSï¼šä¸è¿›è¡Œå‹ç¼©ï¼ˆcompactï¼‰</li>
<li>ParallelOldï¼šåªèƒ½è¿›è¡Œå…¨å †å‹ç¼©ï¼ˆwhile-heap compactionï¼‰ï¼Œä¼šå¯¼è‡´ä¸­æ–­æ—¶é—´å˜é•¿</li>
</ul>
</blockquote>
<p>When performing garbage collections, G1 operates in a manner similar to the CMS collector. G1 performs a concurrent global marking phase to determine the liveness of objects throughout the heap. After the mark phase completes, G1 knows which regions are mostly empty. It collects in these regions first, which usually yields a large amount of free space. This is why this method of garbage collection is called Garbage-First. As the name suggests, G1 concentrates its collection and compaction activity on the areas of the heap that are likely to be full of reclaimable objects, that is, garbage. G1 uses a pause prediction model to meet a user-defined pause time target and selects the number of regions to collect based on the specified pause time target.</p>
<p>The regions identified by G1 as ripe for reclamation are garbage collected using evacuation. G1 copies objects from one or more regions of the heap to a single region on the heap, and in the process both compacts and frees up memory. This evacuation is performed in parallel on multi-processors, to decrease pause times and increase throughput. Thus, with each garbage collection, G1 continuously works to reduce fragmentation, working within the user defined pause times. This is beyond the capability of both the previous methods. CMS (Concurrent Mark Sweep ) garbage collector does not do compaction. ParallelOld garbage collection performs only whole-heap compaction, which results in considerable pause times.</p>
<p>It is important to note that G1 is not a real-time collector. It meets the set pause time target with high probability but not absolute certainty. Based on data from previous collections, G1 does an estimate of how many regions can be collected within the user specified target time. Thus, the collector has a reasonably accurate model of the cost of collecting the regions, and it uses this model to determine which and how many regions to collect while staying within the pause time target.</p>
<p>Note: G1 has both concurrent (runs along with application threads, e.g., refinement, marking, cleanup) and parallel (multi-threaded, e.g., stop the world) phases. Full garbage collections are still single threaded, but if tuned properly your applications should avoid full GCs.</p>
<h1 id="G1-Footprintï¼ˆğŸ™‚-è¿™ä¸ªæ˜¯å ç”¨ç©ºé—´çš„æ„æ€å§ï¼‰"><a href="#G1-Footprintï¼ˆğŸ™‚-è¿™ä¸ªæ˜¯å ç”¨ç©ºé—´çš„æ„æ€å§ï¼‰" class="headerlink" title="G1 Footprintï¼ˆğŸ™‚ è¿™ä¸ªæ˜¯å ç”¨ç©ºé—´çš„æ„æ€å§ï¼‰"></a>G1 Footprintï¼ˆğŸ™‚ è¿™ä¸ªæ˜¯å ç”¨ç©ºé—´çš„æ„æ€å§ï¼‰</h1><blockquote>
<p>ç›¸æ¯”CMSæˆ–ParallelOldGCï¼ŒG1çš„è¿›ç¨‹ï¼ˆJVM process sizeï¼‰ä¼šå¤§äº›ã€‚å› ä¸ºéœ€è¦å­˜å‚¨è®°å½•regionä¿¡æ¯çš„<code>RSets</code>å’Œ<code>CSets</code></p>
</blockquote>
<blockquote>
<ul>
<li><strong>RSets</strong>: æ¯ä¸ªregionä¸€ä¸ªï¼Œè®°å½•regionä¸­çš„å¯¹è±¡å¼•ç”¨ï¼ˆobject referenceï¼‰<br>å†…å­˜å ç”¨å°äº5%ï¼›</li>
<li><strong>CSets</strong>: è®°å½•å°†è¢«å›æ”¶çš„regionï¼ˆwill be collected in a GCï¼‰<br>å†…å­˜å ç”¨å°äº1%ï¼›</li>
</ul>
</blockquote>
<p>If you migrate from the ParallelOldGC or CMS collector to G1, you will likely see a larger JVM process size. This is largely related to â€œaccountingâ€ data structures such as Remembered Sets and Collection Sets. </p>
<p><strong>Remembered Sets</strong> or RSets track object references into a given region. There is one RSet per region in the heap. The RSet enables the parallel and independent collection of a region. The overall footprint impact of RSets is less than 5%.</p>
<p><strong>Collection Sets</strong> or CSets the set of regions that will be collected in a GC. All live data in a CSet is evacuated (copied/moved) during a GC. Sets of regions can be Eden, survivor, and/or old generation. CSets have a less than 1% impact on the size of the JVM.</p>
<h1 id="å“ªäº›æƒ…å†µï¼Œæˆ‘ä»¬é€‚åˆæ¢åˆ°G1"><a href="#å“ªäº›æƒ…å†µï¼Œæˆ‘ä»¬é€‚åˆæ¢åˆ°G1" class="headerlink" title="å“ªäº›æƒ…å†µï¼Œæˆ‘ä»¬é€‚åˆæ¢åˆ°G1"></a>å“ªäº›æƒ…å†µï¼Œæˆ‘ä»¬é€‚åˆæ¢åˆ°G1</h1><blockquote>
<p>å¦‚æœé‡åˆ°è¿™äº›æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘è¿ç§»åˆ°GC</p>
<ul>
<li>full gc è€—æ—¶è¿‡é•¿æˆ–å¤ªé¢‘ç¹</li>
<li>å¯¹è±¡åˆ†é…çš„é€Ÿåº¦å·®è·è¾ƒå¤§</li>
<li>ä¸å¸Œæœ›GCæš‚åœæ—¶é—´è¶…è¿‡0.5-1ç§’</li>
</ul>
</blockquote>
<p>The first focus of G1 is to provide a solution for users running applications that require large heaps with limited GC latency. This means heap sizes of around 6GB or larger, and stable and predictable pause time below 0.5 seconds.</p>
<p>Applications running today with either the CMS or the ParallelOldGC garbage collector would benefit switching to G1 if the application has one or more of the following traits.</p>
<ul>
<li>Full GC durations are too long or too frequent.</li>
<li>The rate of object allocation rate or promotion varies significantly.</li>
<li>Undesired long garbage collection or compaction pauses (longer than 0.5 to 1 second)</li>
</ul>
<p><strong>Note:</strong> If you are using CMS or ParallelOldGC and your application is not experiencing long garbage collection pauses, it is fine to stay with your current collector. Changing to the G1 collector is not a requirement for using the latest JDK.</p>

      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/jvm/" rel="tag"># jvm</a>
          
            <a href="/tags/gc/" rel="tag"># gc</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/15/jvm-memory-error/" rel="next" title="Jvm å¼‚å¸¸">
                <i class="fa fa-chevron-left"></i> Jvm å¼‚å¸¸
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/17/concurrent-vs-parallel/" rel="prev" title="å¹¶å‘(concurrent) VS å¹¶è¡Œ(parallel)">
                å¹¶å‘(concurrent) VS å¹¶è¡Œ(parallel) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars1.githubusercontent.com/u/3364273?v=3&u=ce716f2b74223dc0e4d236c952aa946ce33b4c4b&s=100" alt="ç›—æ¢¦çš„è™çŒ«">
            
              <p class="site-author-name" itemprop="name">ç›—æ¢¦çš„è™çŒ«</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">82</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">93</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#key-word"><span class="nav-number">1.</span> <span class="nav-text">key word</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç®€å•è¯´è¯´G1æ˜¯ä»€ä¹ˆï¼Ÿ"><span class="nav-number">2.</span> <span class="nav-text">ç®€å•è¯´è¯´G1æ˜¯ä»€ä¹ˆï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#G1ç›®æ ‡"><span class="nav-number">2.1.</span> <span class="nav-text">G1ç›®æ ‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸ºä»€ä¹ˆå«åšgarbage-first"><span class="nav-number">2.2.</span> <span class="nav-text">ä¸ºä»€ä¹ˆå«åšgarbage first</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ‰ä»€ä¹ˆä¸åŒ-å¯¹æ¯”Serial-Parallel-CMS"><span class="nav-number">2.3.</span> <span class="nav-text">æœ‰ä»€ä¹ˆä¸åŒ(å¯¹æ¯”Serial,Parallel,CMS)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç›¸å…³çš„command"><span class="nav-number">2.4.</span> <span class="nav-text">ç›¸å…³çš„command</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ€ä½³å®è·µ-Best-practices"><span class="nav-number">2.5.</span> <span class="nav-text">æœ€ä½³å®è·µ Best practices</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CMS-vs-G1"><span class="nav-number">3.</span> <span class="nav-text">CMS vs G1</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#çœ‹å›¾è¯´è¯"><span class="nav-number">3.1.</span> <span class="nav-text">çœ‹å›¾è¯´è¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CMS-å †ç»“æ„ï¼ˆHeap-Structureï¼‰"><span class="nav-number">3.1.1.</span> <span class="nav-text">CMS å †ç»“æ„ï¼ˆHeap Structureï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#G1-å †ç»“æ„ï¼ˆHeap-Structureï¼‰"><span class="nav-number">3.1.2.</span> <span class="nav-text">G1 å †ç»“æ„ï¼ˆHeap Structureï¼‰</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CMS-step"><span class="nav-number">3.2.</span> <span class="nav-text">CMS step</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#G1-step"><span class="nav-number">3.3.</span> <span class="nav-text">G1 step</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#The-G1-Garbage-Collector"><span class="nav-number">4.</span> <span class="nav-text">The G1 Garbage Collector</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#G1-vs-Serial-Parallel-CMS"><span class="nav-number">5.</span> <span class="nav-text">G1 vs Serial,Parallel,CMS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#G1-Footprintï¼ˆğŸ™‚-è¿™ä¸ªæ˜¯å ç”¨ç©ºé—´çš„æ„æ€å§ï¼‰"><span class="nav-number">6.</span> <span class="nav-text">G1 Footprintï¼ˆğŸ™‚ è¿™ä¸ªæ˜¯å ç”¨ç©ºé—´çš„æ„æ€å§ï¼‰</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å“ªäº›æƒ…å†µï¼Œæˆ‘ä»¬é€‚åˆæ¢åˆ°G1"><span class="nav-number">7.</span> <span class="nav-text">å“ªäº›æƒ…å†µï¼Œæˆ‘ä»¬é€‚åˆæ¢åˆ°G1</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 â€“ <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ç›—æ¢¦çš„è™çŒ«</span>

  

  
</div>


  <div class="powered-by">Powered by <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme â€“ <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Gemini</span> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>




  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  
  





  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  
  

  


  

  

  

  

  
  <script src="/js/src/exturl.js?v=6.7.0"></script>


  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('Copied');
          else $(this).text('Copy failed');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('Copy');
        }, 300);
      }).append(e);
    })
  </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


  

</body>
</html>
